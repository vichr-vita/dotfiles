Neovim Configuration Review
==========================

Date: 2026-01-18
Repository: /Users/vitchrubasik/dotfiles/nvim/.config/nvim

This document captures the configuration analysis produced by the assistant. Keep this file as a short, actionable checklist for follow-up changes.

1 — High-level overview
-----------------------
- Entry point: `init.lua`
- User modules: `lua/vichr/` (config/ and plugins/)
- Plugin manager: `lazy.nvim` with `lazy-lock.json`
- Total Lua plugin files: ~39 (plus `init.lua` and config modules)

2 — Critical issues (fix ASAP)
-----------------------------
- Deprecated API: `vim.loop.fs_stat()` used in `init.lua` — replace with `vim.uv.fs_stat()`.
- Completion confusion: both `nvim-cmp` (enabled) and `blink-cmp` (disabled) exist; LSP uses `cmp_nvim_lsp` capabilities but `blink` is referenced as dependency — choose one and align LSP capabilities.
- Duplicate plugin registration: `autoformat.lua` re-registers `neovim/nvim-lspconfig` with an empty config — remove duplicate.
- Unsafe project config loading: `telescope.lua` uses `dofile()` without `pcall` — wrap in `pcall(dofile, ...)`.

3 — Important improvements
--------------------------
- Missing `pcall` protection around `require()`/`dofile()` in multiple plugin configs (telescope, LSP, conform usage). Add `pcall` checks.
- Swap deprecated keymap API (`vim.api.nvim_set_keymap`) to `vim.keymap.set` in at least 5 files (copilot.lua, lsp_config.lua, zen-mode.lua, twilight.lua, lazygit.lua).
- Add `desc` to keymaps to populate which-key menus for ~7 maps currently missing descriptions.
- Aggressive lazy-loading: many plugins load eagerly. Candidate plugins to lazy-load: dadbod suite (on `cmd`), ledger (on `ft`), rainbox-csv (on `ft`), lazygit (on `cmd`), zen-mode/twilight (on `cmd`).
- Remove or delete disabled plugins/configs if not used (e.g., `blink-cmp.lua`, `debug.lua`).

4 — Polish & cleanup
---------------------
- Remove large commented blocks and stale code (cmp, telescope, catppuccin, null-ls, etc.).
- Consolidate icon providers — avoid both `vim-devicons` and `mini.icons` unless intentionally using both.
- Deduplicate dependencies (e.g., `cmp-nvim-lsp` listed twice in one spec).
- Replace hardcoded paths with top-of-file variables for maintainability.

5 — Suggested prioritized next steps
-----------------------------------
1. Fix deprecated API in `init.lua` (`vim.loop` -> `vim.uv`).
2. Decide which completion plugin to keep:
   - Keep `nvim-cmp` and remove `blink-cmp` (recommended), then ensure `lsp_config.lua` uses `cmp_nvim_lsp` capabilities.
   - Or enable `blink-cmp` and update LSP capabilities appropriately.
3. Remove `autoformat.lua` or merge its intent into the main LSP config to avoid duplicate registrations.
4. Add `pcall` guards for risky `require`/`dofile` calls (example in `telescope.lua`).
5. Replace `vim.api.nvim_set_keymap` usages with `vim.keymap.set` and add `desc` fields.
6. Lazy-load obvious non-startup plugins by adding `cmd`, `ft`, or `event` to their lazy spec.

6 — Verification steps
----------------------
- Run formatter: `stylua .` from the repo root to ensure style consistency.
- Start Neovim and check startup messages: open `nvim` and run `:messages`.
- Manually test keymap-related which-key entries and LSP attach/formatting behavior.
- Use `:Lazy log` or `:Lazy health` to inspect plugin load behavior.

7 — Example commit message
--------------------------
"fix(neovim): replace deprecated vim.loop, remove duplicate plugins, add pcall guards, modernize keymaps"

8 — File references
-------------------
- `init.lua`
- `lua/vichr/plugins/cmp.lua`
- `lua/vichr/plugins/blink-cmp.lua`
- `lua/vichr/plugins/autoformat.lua`
- `lua/vichr/plugins/telescope.lua`
- `lua/vichr/config/lsp_config.lua`

9 — Next actions (choose one)
-----------------------------
1) I will implement the critical fixes and open a branch with changes. (recommended)
2) I will only apply the minimal critical fixes.
3) I will perform a full polish pass (style, lazy-loading, cleanup).

If you pick 1 or 3 I will make the edits, run `stylua .`, and present the diffs for review. If you prefer 2 I will only change the deprecated API, remove duplicates, and add pcall to the unsafe `dofile`.


---
This file was generated by the assistant to capture the configuration review. Keep it at `NEOVIM_CONFIG_REVIEW.md` for reference.
